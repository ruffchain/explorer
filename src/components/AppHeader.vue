<style scoped lang="scss">
.app-header {
  border-bottom: solid 1px rgba(58, 78, 103, 0.5);
  background: rgb(58, 78, 103);
  color: #fff;
  .app-header-inner {
    align-items: center;
    height: 46px;
    margin: 0 auto;
    max-width: 1200px;
  }
  .logo {
    display: block;
    margin: 0 10px;
    height: 30px;
  }
  .hd-center {
    flex: 1;
    margin: 0 10px;
    .search-input {
      max-width: 500px;
      float: right;
    }
  }
  .hd-right {
    margin: 0 10px;
    position: relative;
    .i18n-button {
      display: flex;
      color: inherit;
      padding: 3px 10px;
      padding-top: 5px;
      .material-design-icon {
        margin-right: 5px;
        margin-top: -3px;
      }
    }
    .login-button {
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
      border-radius: 60px;
      padding: 3px 10px;
      padding-top: 5px;
      color: inherit;
      &:hover {
        color: #409eff;
        background: rgba($color: #000000, $alpha: 0.2);
      }
      .material-design-icon {
        margin-right: 5px;
        margin-top: -3px;
      }
    }
    .account-dropdown-menu {
      position: absolute;
      right: 0;
      z-index: 999;
      border-radius: 3px;
      padding: 3px;
      border: solid 1px rgba($color: #000000, $alpha: 0.3);
      user-select: none;
      min-width: 100px;
      background: #fff;
      color: #000;
      box-shadow: 0 10px 30px rgba($color: #000000, $alpha: 0.6);
      ul > li {
        padding: 3px 10px;
        cursor: pointer;
        &:hover {
          background: rgba($color: #000000, $alpha: 0.1);
        }
      }
    }
  }
}
</style>

<template>
  <div class="app-header">
    <div class="app-header-inner layout">
      <router-link to="/">
        <img class="logo" src="@/assets/ruff-logo-white.png" />
      </router-link>
      <div class="hd-center">
        <el-input
          class="search-input"
          :placeholder="placeHolder"
          suffix-icon="el-icon-search"
          size="small"
          v-model="searchText"
          @keydown.enter.native="search"
        ></el-input>
      </div>

      <div class="hd-right">
        <a
          class="login-button"
          ref="login"
          @click="openDropdown()"
          @blur="closeDropdown()"
          href="javascript:;"
        >
          <AccountIcon decorative class="icon-20" />
          {{ strAccountIcon }}
        </a>
        <div v-if="showDropdown" class="account-dropdown-menu">
          <ul>
            <template v-if="!isLogin">
              <li @click="login">{{strLogin}}</li>
              <li @click="showCreateAccount = true">{{strCreateAccount}}</li>
            </template>
            <template v-else>
              <li @click="viewAccount">{{strViewAccount}}</li>
              <li @click="logOut">{{strLogOut}}</li>
            </template>
          </ul>
        </div>
      </div>

      <div class="hd-right">
        <a
          class="i18n-button"
          ref="i18n"
          @click="openI18nDropdown()"
          @blur="closeI18nDropdown()"
          href="javascript:;"
        >
          <TranslateIcon decorative class="icon-18" />
          {{ locale }}
        </a>
        <div v-if="showI18nDropdown" class="account-dropdown-menu">
          <ul>
            <template>
              <li @click="onI18nCn">中文</li>
              <li @click="onI18nEn">English</li>
            </template>
          </ul>
        </div>
      </div>
    </div>
    <CreateAccount v-if="showCreateAccount" @close="showCreateAccount = false" />
    <LoginAccount v-if="showLogin" @close="showLogin = false" />
  </div>
</template>

<script>
import AccountIcon from 'vue-material-design-icons/AccountCircle.vue'
import TranslateIcon from 'vue-material-design-icons/Translate.vue'
import CreateAccount from '../views/Account/CreateAccount.vue'
import LoginAccount from '../views/Account/LoginAccount.vue'
import Cookies from 'js-cookie'

export default {
  data() {
    return {
      searchText: '',
      showDropdown: false,
      showCreateAccount: false,
      showLogin: false,
      showI18nDropdown: false,
    }
  },
  components: {
    AccountIcon,
    TranslateIcon,
    CreateAccount,
    LoginAccount,
  },
  computed: {
    isLogin() {
      return !!this.$_APP.privateKey
    },
    locale() {
      let curLocale = Cookies.get('locale') || 'zh-CN'
      if (curLocale === 'en') {
        return this.$t('locale')
      } else {
        return this.$t('locale')
      }
    },
    placeHolder() {
      return this.$t('AppHeader.placeHolder')
    },
    strLogin() {
      return this.$t('AppHeader.login')
    },
    strCreateAccount() {
      return this.$t('AppHeader.createAccount')
    },
    strAccountIcon() {
      //isLogin ? '钱包' : '登录'
      if (!!this.$_APP.privateKey) {
        return this.$t('AppHeader.wallet')
      } else {
        return this.$t('AppHeader.login')
      }
    },
    strViewAccount() {
      return this.$t('AppHeader.viewAccount')
    },
    strLogOut() {
      return this.$t('AppHeader.logOut')
    },
  },
  methods: {
    search() {
      this.searchText &&
        this.$router.push({
          name: 'Search',
          params: { search: this.searchText.trim() },
          query: { t: new Date().getTime() },
        })
    },
    openDropdown() {
      this.$refs.login.focus()
      this.showDropdown = true
    },
    closeDropdown() {
      window.setTimeout(() => {
        this.showDropdown = false
      }, 200)
    },
    openI18nDropdown() {
      this.$refs.i18n.focus()
      this.showI18nDropdown = true
      //console.log(this.$i18n.locale)
    },
    closeI18nDropdown() {
      window.setTimeout(() => {
        this.showI18nDropdown = false
      }, 200)
      //console.log(this.$i18n.locale)
    },
    onI18nCn() {
      this.$i18n.locale = 'zh-CN'
      Cookies.set('locale', 'zh-CN')
    },
    onI18nEn() {
      this.$i18n.locale = 'en'
      Cookies.set('locale', 'en')
    },
    login() {
      this.showLogin = true
    },
    viewAccount() {
      this.$router.push({
        name: 'Wallet',
      })
    },
    logOut() {
      this.$_APP.privateKey = ''
    },
  },
}
</script>
